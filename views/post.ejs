<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/static/css/post.css" />
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <title><%=data.company_name%> ì •ë³´</title>
    </head>
    <body>
        <!-- íšŒì‚¬ ì •ë³´ -->
        <div class="company">
            <div class="imgContainer">
                <img
                    class="companyImg"
                    src="/static/img/default.png"
                    alt="íšŒì‚¬ ë¡œê³ "
                />
            </div>
            <p class="companyName"><%=data.company_name%></p>
            <p class="experienceLevel"><%=data.levels%></p>
            <button class="likeButton">â¤ <%=data.cnt_likes%></button>
        </div>
        <!-- ë³¸ë¬¸ -->
        <div class="content">
            <div class="introduce">
                <h2>ğŸ‘¨â€ğŸ’» íšŒì‚¬ ì†Œê°œ</h2>
                <p><%=data.introduce%></p>
            </div>
            <div class="task">
                <h2>ğŸ“Œ ë‹´ë‹¹ ì—…ë¬´</h2>
                <p><%=data.task%></p>
            </div>
            <div class="condition">
                <h2>ğŸ“œ ìê²© ìš”ê±´</h2>
                <p><%=data.conditions%></p>
            </div>
            <div class="preferentialTreatment">
                <h2>ğŸ‘ ìš°ëŒ€ ì‚¬í•­</h2>
                <p><%=data.prefer%></p>
            </div>
            <div class="skills">
                <h2>ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ</h2>
                <p><%=data.stack%></p>
            </div>
            <div class="welfare">
                <h2>âœ¨ íšŒì‚¬ ë³µì§€</h2>
                <p><%=data.welfare%></p>
            </div>
            <div class="deadline">
                <h2>ğŸ“… ë§ˆê°ì¼</h2>
                <p><%=data.deadline%></p>
            </div>
            <div class="location">
                <h2>ğŸ“ ìœ„ì¹˜</h2>
                <p class="address"><%=data.address%></p>
                <div class="map"></div>
            </div>
            <div class="source">
                <h2>ğŸ“ ê³µê³  ì¶œì²˜</h2>
                <p><%=data.source%></p>
            </div>
            <div class="other">
                <h2>ğŸ’¡ ê¸°íƒ€ ì¶”ê°€ ì •ë³´</h2>
                <p><%=data.others%></p>
            </div>
        </div>
        <div class="contentButton">
            <button class="editButton" onclick="editPost()">ìˆ˜ì •</button>
            <button
                class="deleteButton"
                onclick="deletePost('<%=data.jobs_id%>')"
            >
                ì‚­ì œ
            </button>
        </div>
        <br />
        <!-- ëŒ“ê¸€ -->
        <div class="comments">
            <form name="inputComment">
                <input
                    type="textarea"
                    name="commentText"
                    placeholder="ëŒ“ê¸€ ì…ë ¥"
                />
                <button
                    type="button"
                    class="commentButton"
                    onclick="sendComment('<%=data.jobs_id%>')"
                >
                    ë“±ë¡
                </button>
            </form>
            <br />
            <form name="editCmt">
                <input
                    type="textarea"
                    name="editTxt"
                    placeholder="ì„ì‹œ : ìˆ˜ì •ìš©"
                />
            </form>
            <br />
            <% for (let i= 0; i < reviewsdata.length; i++) { %>
            <div class="commentBox" id="cmt_<%=reviewsdata[i].reviews_id%>">
                <p class="writer"><%=reviewsdata[i].users_id%></p>
                <p class="registerDate"><%=reviewsdata[i].created_at%></p>
                <div class="commentDiv">
                    <p class="comment"><%=reviewsdata[i].reviews_comment%></p>
                    <button
                        class="editCommentButton"
                        onclick="editComment('<%=reviewsdata[i].reviews_id%>')"
                    >
                        ìˆ˜ì •
                    </button>
                    <button
                        class="deleteCommentButton"
                        onclick="deleteComment('<%=reviewsdata[i].reviews_id%>')"
                    >
                        ì‚­ì œ
                    </button>
                </div>
                <button
                    type="button"
                    class="editBtn"
                    onclick="edit('<%=reviewsdata[i].reviews_id%>')"
                >
                    ìˆ˜ì •(ì„ì‹œ)
                </button>
            </div>
            <%}%>
        </div>

        <script>
            // ê¸€ ìˆ˜ì • put /jobs
            // ê¸€ ì‚­ì œ delete /jobs
            function deletePost(jobid) {
                console.log(jobid);
                axios({
                    method: "DELETE",
                    url: "/jobs",
                    data: { jobid: jobid },
                }).then((res) => {
                    if (res) {
                        alert(
                            "ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤."
                        );
                        document.location.href = "/jobs";
                    } else {
                        alert("ê²Œì‹œê¸€ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    }
                });
            }

            // ëŒ“ê¸€ ë“±ë¡ post /review
            const form = document.forms["inputComment"];
            function sendComment(jobid) {
                console.log(form.commentText.value);
                const data = {
                    comment: form.commentText.value,
                    jobsId: jobid,
                };
                if (form.commentText.value.length === 0) {
                    alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                } else {
                    axios({
                        method: "POST",
                        url: "/review",
                        data: data,
                    })
                        .then((res) => {
                            console.log("resdata", res.data);
                        })
                        .catch((err) => console.log(err));
                }
            }

            // ëŒ“ê¸€ ìˆ˜ì • put /review
            function edit(reviewid) {
                console.log(reviewid);
                console.log(document.forms["editCmt"].editTxt.value);
                axios({
                    url: "/review",
                    method: "put",
                    data: {
                        reviewId: reviewid,
                        comment: document.forms["editCmt"].editTxt.value,
                    },
                }).then((res) => {
                    console.log(res);
                });
                //     // í”„ë¡ íŠ¸ì—ì„œ ë°ì´í„° ë³€ê²½í•  ìˆ˜ ìˆë„ë¡
                //     // const children = document.querySelector(
                //     //     `#cmt_${reviewid}`
                //     // ).children;
                //     // console.log(children);
                //     // children[1].textContent = form.name.value;
                //     // children[2].textContent = form.comment.value;
                //     // editCancel();
                // });
                // const children = document.querySelector(
                //     `#cmt_${reviewid}`
                // ).children;
                // console.log(children[2]);
            }

            // ì·¨ì†Œ ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜, ìˆ˜ì •ì´ ëë‚œ í›„ ì‹¤í–‰
            function editCancel() {
                // ë“±ë¡ ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
                btnGroup.innerHTML = `<button type="button" onclick="createVisitor()">ë°©ëª…ë¡ ë“±ë¡</button>`;
            }

            // ëŒ“ê¸€ ì‚­ì œ delete /review
            function deleteComment(reviewid) {
                console.log(reviewid);
                axios({
                    method: "DELETE",
                    url: "/review",
                    data: { reviewId: reviewid },
                }).then((res) => {
                    if (res) {
                        alert("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                        document.location.reload();
                    } else {
                        alert("ëŒ“ê¸€ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    }
                });
            }
        </script>
    </body>
</html>
