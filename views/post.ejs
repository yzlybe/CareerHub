<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/static/css/post.css" />
        <link rel="stylesheet" href="/static/css/dark.css" />
        <script src="/static/js/detail.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <title><%=data.company_name%> ì •ë³´</title>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const darkModeEnabled =
                    localStorage.getItem("darkModeEnabled") === "true";

                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ëœ ê°’ì— ë”°ë¼ ë‹¤í¬ ëª¨ë“œ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€/ì œê±°
                if (darkModeEnabled) {
                    document.body.classList.add("dark-mode");
                }
            });

            // í˜ì´ì§€ë¥¼ ë²—ì–´ë‚  ë•Œ í˜„ì¬ ë‹¤í¬ ëª¨ë“œ ìƒíƒœë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            window.addEventListener("beforeunload", function () {
                const isDarkModeEnabled =
                    document.body.classList.contains("dark-mode");
                localStorage.setItem("darkModeEnabled", isDarkModeEnabled);
            });
        </script>
    </head>
    <body>
        <!-- íšŒì‚¬ ì •ë³´ -->
        <div class="company">
            <div class="imgContainer">
                <img
                    class="companyImg"
                    src="/static/img/default.png"
                    alt="íšŒì‚¬ ë¡œê³ "
                />
            </div>
            <p class="companyName"><%=data.company_name%></p>
            <p class="experienceLevel"><%=data.levels%><%=data.levelValue%></p>
            <button class="likeButton" onclick="increLike('<%=data.jobs_id%>')">
                â¤ <%=data.cnt_likes%>
            </button>
            <button
                class="unlikeButton"
                onclick="reduceLike('<%=data.jobs_id%>')"
            >
                â¤ <%=data.cnt_likes%>
            </button>
        </div>
        <!-- ë³¸ë¬¸ -->
        <div class="content mainBlock">
            <!-- ë³¸ë¬¸ ì¡°íšŒ -->
            <div class="viewContent">
                <div class="introduce">
                    <h2>ğŸ‘¨â€ğŸ’» íšŒì‚¬ ì†Œê°œ</h2>
                    <p><%=data.introduce%></p>
                </div>
                <div class="task">
                    <h2>ğŸ“Œ ë‹´ë‹¹ ì—…ë¬´</h2>
                    <p><%=data.task%></p>
                </div>
                <div class="condition">
                    <h2>ğŸ“œ ìê²© ìš”ê±´</h2>
                    <p><%=data.conditions%></p>
                </div>
                <div class="preferentialTreatment">
                    <h2>ğŸ‘ ìš°ëŒ€ ì‚¬í•­</h2>
                    <p><%=data.prefer%></p>
                </div>
                <div class="skills">
                    <h2>ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ</h2>
                    <p><%=data.stack%></p>
                </div>
                <div class="welfare">
                    <h2>âœ¨ íšŒì‚¬ ë³µì§€</h2>
                    <p><%=data.welfare%></p>
                </div>
                <div class="deadline">
                    <h2>ğŸ“… ë§ˆê°ì¼</h2>
                    <p><%=data.deadline%></p>
                </div>
                <div class="location">
                    <h2>ğŸ“ ìœ„ì¹˜</h2>
                    <p class="address"><%=data.address%></p>
                    <div class="map"></div>
                </div>
                <div class="source">
                    <h2>ğŸ“ ê³µê³  ì¶œì²˜</h2>
                    <p><%=data.source%></p>
                </div>
                <div class="other">
                    <h2>ğŸ’¡ ê¸°íƒ€ ì¶”ê°€ ì •ë³´</h2>
                    <p><%=data.others%></p>
                </div>
            </div>
            <!-- ë³¸ë¬¸ ìˆ˜ì • -->
            <div class="editContent hidden">
                <form name="editContent">
                    <h2>ğŸ“• íšŒì‚¬ ë¡œê³ </h2>
                    <img
                        id="resultImage"
                        src="/static/img/default.png"
                        alt="ê¸°ë³¸ í”„ë¡œí•„ ì´ë¯¸ì§€"
                        width="100"
                        height="100"
                        class="profile"
                    />

                    <span class="filebox">
                        <label for="img_path" class="input-file-button">
                            íšŒì‚¬ ë¡œê³  ì—…ë¡œë“œ
                        </label>
                        <input
                            type="file"
                            id="img_path"
                            name="img_path"
                            onchange="fileUpload()"
                            style="display: none"
                        />
                    </span>
                    <br />

                    <h2>ğŸ“— íšŒì‚¬ëª…</h2>
                    <input
                        type="text"
                        name="company_name"
                        placeholder="íšŒì‚¬ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
                        class="text-input"
                        value="<%=data.introduce%>"
                        required
                    />
                    <br />

                    <h2>ğŸ“˜ ê²½ë ¥</h2>
                    <div name="form-check-label">
                        <label class="form-check-label">
                            <input
                                type="radio"
                                name="levels"
                                value="ì‹ ì…"
                                class="form-check-input"
                            />
                            ì‹ ì…
                        </label>
                        <label class="form-check-label">
                            <input
                                type="radio"
                                name="levels"
                                value="ê²½ë ¥"
                                class="form-check-input"
                            />
                            ê²½ë ¥
                        </label>
                        <label class="form-check-label">
                            <input
                                type="radio"
                                name="levels"
                                value="ë¬´ê´€"
                                class="form-check-input"
                            />
                            ê²½ë ¥ ë¬´ê´€
                        </label>
                    </div>

                    <h2>ğŸ‘¨â€ğŸ’» íšŒì‚¬ ì†Œê°œ</h2>
                    <textarea
                        name="introduce"
                        placeholder="íšŒì‚¬ì— ëŒ€í•œ ì†Œê°œë¥¼ ì ì–´ì£¼ì„¸ìš”"
                        class="textarea-input"
                        style="resize: none"
                    >
                    </textarea>

                    <h2>ğŸ“Œ ë‹´ë‹¹ ì—…ë¬´</h2>
                    <textarea
                        name="task"
                        placeholder="íšŒì‚¬ì— ì…ì‚¬í•˜ë©´ ì–´ë–¤ ì¼ì„ í•˜ê²Œ ë˜ë‚˜ìš”?"
                        class="textarea-input"
                        style="resize: none"
                    ></textarea>

                    <h2>ğŸ“œ ìê²©ìš”ê±´</h2>
                    <textarea
                        name="conditions"
                        placeholder="íšŒì‚¬ì— ì…ì‚¬í•˜ë ¤ë©´ ì–´ë–¤ ì¤€ë¹„ê°€ ë˜ì–´ìˆì–´ì•¼ í•˜ë‚˜ìš”?"
                        class="textarea-input"
                        style="resize: none"
                    ></textarea>

                    <h2>ğŸ‘ ìš°ëŒ€ ì‚¬í•­</h2>
                    <textarea
                        name="prefer"
                        placeholder="íšŒì‚¬ì— ì…ì‚¬í•˜ëŠ”ë° ìš°ëŒ€í•˜ëŠ” ì‚¬í•­ì€ ë¬´ì—‡ì¸ê°€ìš”?"
                        class="textarea-input"
                        style="resize: none"
                    ></textarea>

                    <!-- ìŠ¤íƒ ë°•ìŠ¤ -->
                    <h2>ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ</h2>
                    <div class="Checkbox" id="stackButtons">
                        <input
                            type="checkbox"
                            name="stack"
                            id="reactCheckbox"
                            value="React"
                            class="form-check-input"
                            style="resize: none"
                        />
                        <label
                            for="reactCheckbox"
                            class="form-check-label button-label"
                            >React</label
                        >

                        <input
                            type="checkbox"
                            name="stack"
                            id="vueCheckbox"
                            value="Vue"
                            class="form-check-input"
                        />
                        <label
                            for="vueCheckbox"
                            class="form-check-label button-label"
                            >Vue</label
                        >

                        <input
                            type="checkbox"
                            name="stack"
                            id="cssCheckbox"
                            value="CSS"
                            class="form-check-input"
                        />
                        <label
                            for="cssCheckbox"
                            class="form-check-label button-label"
                            >CSS</label
                        >

                        <input
                            type="checkbox"
                            name="stack"
                            id="angularCheckbox"
                            value="Angular"
                            class="form-check-input"
                        />
                        <label
                            for="angularCheckbox"
                            class="form-check-label button-label"
                            >Angular</label
                        >

                        <input
                            type="checkbox"
                            name="stack"
                            id="javascriptCheckbox"
                            value="JavaScript"
                            class="form-check-input"
                        />
                        <label
                            for="javascriptCheckbox"
                            class="form-check-label button-label"
                            >JavaScript</label
                        >

                        <input
                            type="checkbox"
                            name="stack"
                            id="htmlCheckbox"
                            value="HTML"
                            class="form-check-input"
                        />
                        <label
                            for="htmlCheckbox"
                            class="form-check-label button-label"
                            >HTML</label
                        >

                        <input
                            type="checkbox"
                            name="stack"
                            id="typescriptCheckbox"
                            value="TypeScript"
                            class="form-check-input"
                        />
                        <label
                            for="typescriptCheckbox"
                            class="form-check-label button-label"
                            >TypeScript</label
                        >

                        <input
                            type="checkbox"
                            name="stack"
                            id="sassCheckbox"
                            value="Sass"
                            class="form-check-input"
                        />
                        <label
                            for="sassCheckbox"
                            class="form-check-label button-label"
                            >Sass</label
                        >

                        <input
                            type="checkbox"
                            name="stack"
                            id="jsxCheckbox"
                            value="JSX"
                            class="form-check-input"
                        />
                        <label
                            for="jsxCheckbox"
                            class="form-check-label button-label"
                            >JSX</label
                        >

                        <input
                            type="checkbox"
                            name="stack"
                            id="webpackCheckbox"
                            value="Webpack"
                            class="form-check-input"
                        />
                        <label
                            for="webpackCheckbox"
                            class="form-check-label button-label"
                            >Webpack</label
                        >
                    </div>

                    <h2>âœ¨ íšŒì‚¬ ë³µì§€</h2>
                    <textarea
                        name="welfaer"
                        placeholder="ì–´ë–¤ ë³µì§€ì™€ í˜œíƒì´ ìˆë‚˜ìš”?"
                        class="textarea-input"
                        style="resize: none"
                    ></textarea>

                    <h2>ğŸ“… ë§ˆê°ì¼</h2>
                    <input
                        type="datetime-local"
                        id="deadline"
                        name="deadline"
                        required
                    />
                    ê¹Œì§€

                    <h2>ğŸ“ ìœ„ì¹˜</h2>

                    <div
                        id="map"
                        style="width: 900px; height: 400px; margin-top: 10px"
                    ></div>
                    <br />
                    <!-- ì£¼ì†Œ ê²€ìƒ‰ ë²„íŠ¼ -->
                    <input
                        type="button"
                        class="input-file-button"
                        onclick="sample5_execDaumPostcode()"
                        value="ì£¼ì†Œ ê²€ìƒ‰"
                    />
                    <!-- í˜„ìœ„ì¹˜ ë²„íŠ¼ -->
                    <input
                        type="button"
                        class="input-file-button"
                        onclick="getCurrentLocation()"
                        value="í˜„ìœ„ì¹˜ ì°¾ê¸°"
                    /><br /><br />

                    <!-- ì£¼ì†Œ ì…ë ¥ í•„ë“œ -->
                    <input
                        type="text"
                        name="address"
                        id="sample5_address"
                        placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰ í›„ í•´ë‹¹ ì¥ì†Œë¥¼ í´ë¦­í•˜ì‹œë©´ ì£¼ì†Œê°€ ê¸°ì…ë©ë‹ˆë‹¤"
                        class="text-input"
                        readonly
                    /><br /><br />
                    <!-- ìƒì„¸ ì£¼ì†Œ ì…ë ¥ í•„ë“œ -->
                    <input
                        type="text"
                        name="address_detail"
                        placeholder="ìƒì„¸ ì£¼ì†Œë¥¼ ì ì–´ì£¼ì„¸ìš” (ì„ íƒ)"
                        class="text-input"
                    /><br /><br />

                    <h2>ğŸ“ ê³µê³  ì¶œì²˜</h2>
                    <input
                        type="text"
                        name="source"
                        placeholder="ì–´ë–¤ ì‚¬ì´íŠ¸ì—ì„œ ì •ë³´ë¥¼ ë°›ì•˜ëŠ”ì§€ ì¶œì²˜ë¥¼ ê¼­ ë°í˜€ì£¼ì„¸ìš”!"
                        class="text-input"
                    />

                    <h2>ğŸ’¡ ê¸°íƒ€ ì¶”ê°€ ì •ë³´</h2>
                    <textarea
                        name="others"
                        placeholder="íšŒì‚¬ì— ëŒ€í•œ ì¶”ê°€ ì •ë³´ í˜¹ì€ ì—¬ëŸ¬ë¶„ì˜ ììœ ë¡œìš´ ì˜ê²¬ì„ ì¨ì£¼ì„¸ìš”(ì„ íƒ)"
                        class="textarea-input"
                        style="resize: none"
                    ></textarea>
                    <br />
                    <!-- ìˆ˜ì • í™•ì¸ ë²„íŠ¼ -->
                    <button type="button" onclick="editPost()">
                        ìˆ˜ì •(ì™„ë£Œ)
                    </button>
                </form>
            </div>
        </div>
        <div class="contentButtons">
            <!-- ìˆ˜ì •ì°½ ì „í™˜ ë²„íŠ¼ -->
            <button
                class="editReqButton"
                onclick="editReqPost('<%=data.userId%>')"
            >
                ìˆ˜ì •(ì „í™˜)
            </button>
            <button
                class="deleteButton"
                onclick="deletePost('<%=data.jobs_id%>')"
            >
                ì‚­ì œ
            </button>
        </div>
        <br />
        <!-- ëŒ“ê¸€ -->
        <div class="comments mainBlock">
            <!-- ëŒ“ê¸€ ë“±ë¡ -->
            <form name="inputComment">
                <input
                    type="textarea"
                    name="commentText"
                    placeholder="ëŒ“ê¸€ ì…ë ¥"
                />
                <button
                    type="button"
                    class="commentButton"
                    onclick="sendCmt('<%=data.jobs_id%>')"
                >
                    ë“±ë¡
                </button>
            </form>
            <br />
            <!-- ëŒ“ê¸€ ì¡°íšŒ -->
            <!-- Todo: ì˜ˆì™¸ì²˜ë¦¬ ì¶”ê°€í•˜ê¸° -->
            <% for (let i= 0; i < reviewsdata.length; i++) { %>
            <div class="commentBox" id="cmt_<%=reviewsdata[i].reviews_id%>">
                <p class="writer"><%=reviewsdata[i].nickname%></p>
                <p class="registerDate"><%=reviewsdata[i].created_at%></p>
                <!-- ìˆ˜ì •ì°½ ì „í™˜ ì‹œ ì‚¬ë¼ì§ -->
                <span class="commentButtons">
                    <button
                        class="editReqCommentButton"
                        onclick="editReqCmt('<%=reviewsdata[i].reviews_id%>')"
                    >
                        <!-- ìˆ˜ì •ì°½ ì „í™˜ ë²„íŠ¼ -->
                        ìˆ˜ì •
                    </button>
                    <span>|</span>
                    <button
                        class="deleteCommentButton"
                        onclick="deleteCmt('<%=reviewsdata[i].reviews_id%>')"
                    >
                        ì‚­ì œ
                    </button>
                    <div class="commentDiv">
                        <p class="comment">
                            <%=reviewsdata[i].reviews_comment%>
                        </p>
                    </div>
                </span>

                <!-- ìˆ˜ì •ì°½ ì „í™˜ ì‹œ ë‚˜íƒ€ë‚¨ -->
                <form
                    name="editComment_<%=reviewsdata[i].reviews_id%>"
                    class="editComment hidden"
                >
                    <input type="text" name="editTxt" value="opoop" />
                    <button
                        type="button"
                        class="editCommentButton"
                        onclick="editCmt('<%=reviewsdata[i].reviews_id%>')"
                    >
                        <!-- ìˆ˜ì • í™•ì¸ ë²„íŠ¼ -->
                        ìˆ˜ì •
                    </button>
                    <button
                        type="button"
                        class="editCancelCommentButton"
                        onclick="editReqCmt('<%=reviewsdata[i].reviews_id%>')"
                    >
                        ì·¨ì†Œ
                    </button>
                </form>
            </div>
            <%}%>
        </div>

        <script>
            // ì¢‹ì•„ìš” ì¦ê°€ patch /like
            function increLike(jobid) {
                console.log(jobid);
                axios({
                    url: "/like",
                    method: "PATCH",
                    data: {
                        jobsId: jobid,
                    },
                });
            }
            // ì¢‹ì•„ìš” ê°ì†Œ patch /unlike
            function reduceLike(jobid) {
                console.log(jobid);
                axios({
                    url: "/unlike",
                    method: "PATCH",
                    data: {
                        jobsId: jobid,
                    },
                });
            }

            // ê¸€ ìˆ˜ì •ì°½ ì „í™˜
            function editReqPost(userid) {
                window.scrollTo({ left: 0, top: 0, behavior: "smooth" });
                const post = document.querySelector(".content");
                const onDefault = post.querySelector(".viewContent");
                const offDefault = post.querySelector(".editContent");
                onDefault.classList.toggle("hidden");
                offDefault.classList.toggle("hidden");
            }

            // ê¸€ ìˆ˜ì • patch /jobs
            function editPost(jobid) {
                const form = document.forms["editContent"];
                console.log(form);
                //     axios({
                //         url: "/jobs",
                //         method: "PATCH",
                //         data: {
                //             jobsId: jobid,
                //             usersId,
                //             updated_at,
                //             img_path,
                //             companyName,
                //             levels,
                //             introduce,
                //             task,
                //             conditions,
                //             prefer,
                //             welfaer,
                //             deadline,
                //             address,
                //             address_detail,
                //             others,
                //             source,
                //         },
                //     })
                //         .then((res) => {
                //             console.log(res);
                //             document.location.reload();
                //         })
                //         .catch((err) => console.log(err));
                window.scrollTo({ left: 0, top: 0, behavior: "smooth" });
            }

            // ê¸€ ì‚­ì œ delete /jobs
            function deletePost(jobid) {
                console.log(jobid);
                axios({
                    method: "DELETE",
                    url: "/jobs",
                    data: { jobid: jobid },
                }).then((res) => {
                    if (res) {
                        alert(
                            "ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë©”ì¸í˜ì´ì§€ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤."
                        );
                        document.location.href = "/";
                    } else {
                        alert("ê²Œì‹œê¸€ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    }
                });
            }

            // ëŒ“ê¸€ ë“±ë¡ post /review
            function sendCmt(jobid) {
                const checkLogin = JSON.parse(localStorage.isLoggedIn);
                if (checkLogin) {
                    const form = document.forms["inputComment"];
                    console.log("comment", form.commentText.value);
                    console.log("jobsId", jobid);
                    console.log("userId", localStorage.userId);
                    const data = {
                        jobsId: jobid,
                        comment: form.commentText.value,
                        userId: localStorage.userId,
                    };
                    if (form.commentText.value.length === 0) {
                        alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                        return;
                    } else {
                        axios({
                            method: "POST",
                            url: "/review",
                            data: data,
                        })
                            .then((res) => {
                                console.log("resdata", res.data);
                                document.location.reload();
                                // window.scrollBy(0, window.innerHeight);
                            })
                            .catch((err) => console.log(err));
                    }
                } else {
                    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                    return;
                }
            }

            // ëŒ“ê¸€ ìˆ˜ì •ì°½ ì „í™˜
            // ì‚¬ë¼ì§ˆ ë¶€ë¶„ commentButtons ë‚˜ì˜¬ ë¶€ë¶„ editComment
            // ë‚˜ì¤‘ì— ìµœì í™” í•˜ê¸°
            function editReqCmt(reviewid) {
                const findCmt = document.getElementById(`cmt_${reviewid}`);
                const cmtTxt = findCmt.querySelector(".comment").innerText;
                const onDefault = findCmt.querySelector(".commentButtons");
                const offDefault = findCmt.querySelector(".editComment");
                onDefault.classList.toggle("hidden");
                offDefault.classList.toggle("hidden");
                const txtbox = findCmt.querySelector("input");
                txtbox.setAttribute("value", `${cmtTxt}`);
            }

            // ëŒ“ê¸€ ìˆ˜ì • PATCH /review
            function editCmt(reviewid) {
                const form = document.forms[`editComment_${reviewid}`];
                if (form.editTxt.value.length === 0) {
                    alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                } else {
                    axios({
                        url: "/review",
                        method: "PATCH",
                        data: {
                            reviewId: reviewid,
                            comment:
                                document.forms[`editComment_${reviewid}`]
                                    .editTxt.value,
                        },
                    })
                        .then((res) => {
                            console.log(res);
                            document.location.reload();
                        })
                        .catch((err) => console.log(err));
                }
            }

            // ëŒ“ê¸€ ì‚­ì œ delete /review
            function deleteCmt(reviewid) {
                console.log(reviewid);
                axios({
                    method: "DELETE",
                    url: "/review",
                    data: { reviewId: reviewid },
                }).then((res) => {
                    if (res) {
                        alert("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                        document.location.reload();
                    } else {
                        alert("ëŒ“ê¸€ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    }
                });
            }
        </script>
    </body>
</html>
